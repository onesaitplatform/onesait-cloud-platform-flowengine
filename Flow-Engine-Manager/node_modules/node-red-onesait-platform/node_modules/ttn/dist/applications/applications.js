"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ApplicationClient = undefined;

var _keys = require("babel-runtime/core-js/object/keys");

var _keys2 = _interopRequireDefault(_keys);

var _extends2 = require("babel-runtime/helpers/extends");

var _extends3 = _interopRequireDefault(_extends2);

var _regenerator = require("babel-runtime/regenerator");

var _regenerator2 = _interopRequireDefault(_regenerator);

var _toConsumableArray2 = require("babel-runtime/helpers/toConsumableArray");

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _asyncToGenerator2 = require("babel-runtime/helpers/asyncToGenerator");

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _classCallCheck2 = require("babel-runtime/helpers/classCallCheck");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require("babel-runtime/helpers/createClass");

var _createClass3 = _interopRequireDefault(_createClass2);

var _sourceMapSupport2 = require("source-map-support");

var _grpc = require("grpc");

var _grpc2 = _interopRequireDefault(_grpc);

var _handler_pb = require("ttnapi/handler/handler_pb");

var _handler_pb2 = _interopRequireDefault(_handler_pb);

var _device_pb = require("ttnapi/protocol/lorawan/device_pb");

var _device_pb2 = _interopRequireDefault(_device_pb);

var _handler_grpc_pb = require("ttnapi/handler/handler_grpc_pb");

var _handler_grpc_pb2 = _interopRequireDefault(_handler_grpc_pb);

var _device_address_grpc_pb = require("ttnapi/protocol/lorawan/device_address_grpc_pb");

var _device_address_grpc_pb2 = _interopRequireDefault(_device_address_grpc_pb);

var _device_address_pb = require("ttnapi/protocol/lorawan/device_address_pb");

var _device_address_pb2 = _interopRequireDefault(_device_address_pb);

var _utils = require("../utils");

var _isToken = require("../utils/is-token");

var _isToken2 = _interopRequireDefault(_isToken);

var _account = require("../account");

var _normalize = require("./normalize");

var _normalize2 = _interopRequireDefault(_normalize);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

(0, _sourceMapSupport2.install)(); // Copyright Â© 2017 The Things Network
// Use of this source code is governed by the MIT license that can be found in the LICENSE file.

// Necessary to make gRPC work
process.env.GRPC_SSL_CIPHER_SUITES = _utils.MODERN_CIPHER_SUITES;

/**
 * A client that manages devices on the handler.
 */

var ApplicationClient = exports.ApplicationClient = function () {

  /**
   * Create and open an application manager client that can be used for
   * retreiving and updating an application and its devices.
   *
   * @param appID - The ID of the application you want to manage
   * @param tokenOrKey - The Access Token or Access Key used to authenticate
   * @param netAddress - The gRPC address of the handler where the application is registered
   * @param certificate - An optional certificate used to connect to the handler securely
   */


  /** @private */


  /** @private */


  /** @private */
  function ApplicationClient(appID, tokenOrKey, netAddress, certificate) {
    (0, _classCallCheck3.default)(this, ApplicationClient);

    var credentials = certificate ? _grpc2.default.credentials.createSsl(certificate && new Buffer(certificate)) : _grpc2.default.credentials.createInsecure();

    this.client = new _handler_grpc_pb2.default.ApplicationManagerClient(netAddress, credentials);
    this.credentials = credentials;
    this.netAddress = netAddress;
    this.appID = appID;

    if ((0, _isToken2.default)(tokenOrKey)) {
      this.appAccessToken = tokenOrKey;
    } else {
      this.appAccessKey = tokenOrKey;
    }

    this.accountClient = new _account.AccountClient(tokenOrKey);
  }

  /** @private */


  /** @private */


  /** @private */


  /** @private */


  /** @private */


  (0, _createClass3.default)(ApplicationClient, [{
    key: "exec",
    value: function () {
      var _ref = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee(fn) {
        for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
          args[_key - 1] = arguments[_key];
        }

        var meta, res;
        return _regenerator2.default.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                meta = new _grpc2.default.Metadata();

                if (this.appAccessToken) {
                  meta.add("token", this.appAccessToken);
                } else if (this.appAccessKey) {
                  meta.add("key", this.appAccessKey);
                }

                _context.next = 4;
                return _utils.wrap.apply(undefined, [this.client, fn].concat((0, _toConsumableArray3.default)(args), [meta]));

              case 4:
                res = _context.sent;
                return _context.abrupt("return", res.toObject());

              case 6:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this);
      }));

      function exec(_x) {
        return _ref.apply(this, arguments);
      }

      return exec;
    }()

    /**
     * Get the application
     */

  }, {
    key: "get",
    value: function () {
      var _ref2 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee2() {
        var req, app;
        return _regenerator2.default.wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                req = new _handler_pb2.default.ApplicationIdentifier();

                req.setAppId(this.appID);

                _context2.next = 4;
                return this.exec(this.client.getApplication, req);

              case 4:
                app = _context2.sent;

                app.payloadFormat = app.payloadFormat || "custom";

                return _context2.abrupt("return", app);

              case 7:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, this);
      }));

      function get() {
        return _ref2.apply(this, arguments);
      }

      return get;
    }()

    /**
     * Change the payload format of the application.
     */

  }, {
    key: "setPayloadFormat",
    value: function () {
      var _ref3 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee3(format) {
        return _regenerator2.default.wrap(function _callee3$(_context3) {
          while (1) {
            switch (_context3.prev = _context3.next) {
              case 0:
                _context3.next = 2;
                return this.set({
                  payloadFormat: format
                });

              case 2:
              case "end":
                return _context3.stop();
            }
          }
        }, _callee3, this);
      }));

      function setPayloadFormat(_x2) {
        return _ref3.apply(this, arguments);
      }

      return setPayloadFormat;
    }()

    /**
     * Set the custom payload functions of the application and set the format
     * to custom.
     */

  }, {
    key: "setCustomPayloadFunctions",
    value: function () {
      var _ref4 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee4() {
        var fns = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
        return _regenerator2.default.wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                _context4.next = 2;
                return this.set((0, _extends3.default)({
                  payloadFormat: "custom"
                }, fns));

              case 2:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee4, this);
      }));

      function setCustomPayloadFunctions() {
        return _ref4.apply(this, arguments);
      }

      return setCustomPayloadFunctions;
    }()

    /**
     * Set the registerOnJoinAccessKey or remove it.
     */

  }, {
    key: "setRegisterOnJoinAccessKey",
    value: function () {
      var _ref5 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee5(to) {
        return _regenerator2.default.wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                _context5.next = 2;
                return this.set({
                  registerOnJoinAccessKey: to
                });

              case 2:
              case "end":
                return _context5.stop();
            }
          }
        }, _callee5, this);
      }));

      function setRegisterOnJoinAccessKey(_x4) {
        return _ref5.apply(this, arguments);
      }

      return setRegisterOnJoinAccessKey;
    }()

    /**
     * Unregister the application from the handler.
     */

  }, {
    key: "unregister",
    value: function () {
      var _ref6 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee6() {
        var req;
        return _regenerator2.default.wrap(function _callee6$(_context6) {
          while (1) {
            switch (_context6.prev = _context6.next) {
              case 0:
                req = new _handler_pb2.default.ApplicationIdentifier();

                req.setAppId(this.appID);
                return _context6.abrupt("return", this.exec(this.client.deleteApplication, req));

              case 3:
              case "end":
                return _context6.stop();
            }
          }
        }, _callee6, this);
      }));

      function unregister() {
        return _ref6.apply(this, arguments);
      }

      return unregister;
    }()

    /** @private */

  }, {
    key: "set",
    value: function () {
      var _ref7 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee7() {
        var updates = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
        var req;
        return _regenerator2.default.wrap(function _callee7$(_context7) {
          while (1) {
            switch (_context7.prev = _context7.next) {
              case 0:
                req = new _handler_pb2.default.Application();


                req.setAppId(this.appID);

                if ("payloadFormat" in updates) {
                  req.setPayloadFormat(updates.payloadFormat);
                }

                if ("registerOnJoinAccessKey" in updates) {
                  req.setRegisterOnJoinAccessKey(updates.registerOnJoinAccessKey);
                }

                if ("decoder" in updates) {
                  req.setDecoder(updates.decoder);
                }

                if ("converter" in updates) {
                  req.setConverter(updates.converter);
                }

                if ("validator" in updates) {
                  req.setValidator(updates.validator);
                }

                if ("encoder" in updates) {
                  req.setEncoder(updates.encoder);
                }

                return _context7.abrupt("return", this.exec(this.client.setApplication, req));

              case 9:
              case "end":
                return _context7.stop();
            }
          }
        }, _callee7, this);
      }));

      function set() {
        return _ref7.apply(this, arguments);
      }

      return set;
    }()

    /**
     * List the devices of the application
     */

  }, {
    key: "devices",
    value: function () {
      var _ref8 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee8() {
        var req, res;
        return _regenerator2.default.wrap(function _callee8$(_context8) {
          while (1) {
            switch (_context8.prev = _context8.next) {
              case 0:
                req = new _handler_pb2.default.ApplicationIdentifier();

                req.setAppId(this.appID);
                _context8.next = 4;
                return this.exec(this.client.getDevicesForApplication, req);

              case 4:
                res = _context8.sent;
                return _context8.abrupt("return", res.devicesList.map(_normalize2.default));

              case 6:
              case "end":
                return _context8.stop();
            }
          }
        }, _callee8, this);
      }));

      function devices() {
        return _ref8.apply(this, arguments);
      }

      return devices;
    }()

    /**
     * Register a device in the application.
     */

  }, {
    key: "registerDevice",
    value: function () {
      var _ref9 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee9(devID, device) {
        return _regenerator2.default.wrap(function _callee9$(_context9) {
          while (1) {
            switch (_context9.prev = _context9.next) {
              case 0:
                return _context9.abrupt("return", this.setDevice(devID, device));

              case 1:
              case "end":
                return _context9.stop();
            }
          }
        }, _callee9, this);
      }));

      function registerDevice(_x6, _x7) {
        return _ref9.apply(this, arguments);
      }

      return registerDevice;
    }()

    /**
     * Get the device specified by the devID
     */

  }, {
    key: "device",
    value: function () {
      var _ref10 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee10(devID) {
        var req, res;
        return _regenerator2.default.wrap(function _callee10$(_context10) {
          while (1) {
            switch (_context10.prev = _context10.next) {
              case 0:
                req = new _handler_pb2.default.DeviceIdentifier();

                req.setAppId(this.appID);
                req.setDevId(devID);
                _context10.next = 5;
                return this.exec(this.client.getDevice, req);

              case 5:
                res = _context10.sent;
                return _context10.abrupt("return", (0, _normalize2.default)(res));

              case 7:
              case "end":
                return _context10.stop();
            }
          }
        }, _callee10, this);
      }));

      function device(_x8) {
        return _ref10.apply(this, arguments);
      }

      return device;
    }()

    /** @private */

  }, {
    key: "setDevice",
    value: function () {
      var _ref11 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee11(devID, device) {
        var req;
        return _regenerator2.default.wrap(function _callee11$(_context11) {
          while (1) {
            switch (_context11.prev = _context11.next) {
              case 0:
                req = this.deviceRequest(devID, device);
                return _context11.abrupt("return", this.exec(this.client.setDevice, req));

              case 2:
              case "end":
                return _context11.stop();
            }
          }
        }, _callee11, this);
      }));

      function setDevice(_x9, _x10) {
        return _ref11.apply(this, arguments);
      }

      return setDevice;
    }()

    /**
     * Update the device specified by the devID with the specified updates
     */

  }, {
    key: "updateDevice",
    value: function () {
      var _ref12 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee12(devID, updates) {
        var device, req;
        return _regenerator2.default.wrap(function _callee12$(_context12) {
          while (1) {
            switch (_context12.prev = _context12.next) {
              case 0:
                _context12.next = 2;
                return this.device(devID);

              case 2:
                device = _context12.sent;
                req = this.deviceRequest(devID, (0, _extends3.default)({}, device, updates));
                return _context12.abrupt("return", this.exec(this.client.setDevice, req));

              case 5:
              case "end":
                return _context12.stop();
            }
          }
        }, _callee12, this);
      }));

      function updateDevice(_x11, _x12) {
        return _ref12.apply(this, arguments);
      }

      return updateDevice;
    }()

    /**
     * Delete the specified device.
     */

  }, {
    key: "deleteDevice",
    value: function () {
      var _ref13 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee13(devID) {
        var req;
        return _regenerator2.default.wrap(function _callee13$(_context13) {
          while (1) {
            switch (_context13.prev = _context13.next) {
              case 0:
                req = new _handler_pb2.default.DeviceIdentifier();

                req.setAppId(this.appID);
                req.setDevId(devID);
                return _context13.abrupt("return", this.exec(this.client.deleteDevice, req));

              case 4:
              case "end":
                return _context13.stop();
            }
          }
        }, _callee13, this);
      }));

      function deleteDevice(_x13) {
        return _ref13.apply(this, arguments);
      }

      return deleteDevice;
    }()

    /** @private */

  }, {
    key: "deviceRequest",
    value: function deviceRequest(devID) {
      var device = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

      var req = new _handler_pb2.default.Device();
      req.setAppId(this.appID);
      req.setDevId(devID);

      if ("description" in device) {
        req.setDescription(device.description);
      }

      if ("latitude" in device) {
        req.setLatitude(device.latitude);
      }

      if ("longitude" in device) {
        req.setLongitude(device.longitude);
      }

      if ("altitude" in device) {
        req.setAltitude(device.altitude);
      }

      if ("attributes" in device) {
        (0, _keys2.default)(device.attributes).forEach(function (key) {
          req.getAttributesMap().set(key, device.attributes[key]);
        });
      }

      req.setLorawanDevice(this.lorawanDeviceRequest(devID, device));

      return req;
    }

    /** @private */

  }, {
    key: "lorawanDeviceRequest",
    value: function lorawanDeviceRequest(devID) {
      var device = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

      var req = new _device_pb2.default.Device();

      req.setAppId(this.appID);
      req.setDevId(devID);

      if ("appEui" in device) {
        req.setAppEui(new Uint8Array(new Buffer(device.appEui, "hex")));
      }

      if ("devEui" in device) {
        req.setDevEui(new Uint8Array(new Buffer(device.devEui, "hex")));
      }

      if ("devAddr" in device) {
        req.setDevAddr(new Uint8Array(new Buffer(device.devAddr, "hex")));
      }

      if ("nwkSKey" in device) {
        req.setNwkSKey(new Uint8Array(new Buffer(device.nwkSKey, "hex")));
      }

      if ("appSKey" in device) {
        req.setAppSKey(new Uint8Array(new Buffer(device.appSKey, "hex")));
      }

      if ("appKey" in device) {
        req.setAppKey(new Uint8Array(new Buffer(device.appKey, "hex")));
      }

      if ("fCntUp" in device) {
        req.setFCntUp(device.fCntUp);
      }

      if ("fCntDown" in device) {
        req.setFCntDown(device.fCntDown);
      }

      if ("disableFCntCheck" in device) {
        req.setDisableFCntCheck(device.disableFCntCheck);
      }

      if ("uses32BitFCnt" in device) {
        req.setUses32BitFCnt(device.uses32BitFCnt);
      }

      return req;
    }

    /**
     * Returns the EUI(s) for this application from the account server.
     */

  }, {
    key: "getEUIs",
    value: function () {
      var _ref14 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee14() {
        var appInfo;
        return _regenerator2.default.wrap(function _callee14$(_context14) {
          while (1) {
            switch (_context14.prev = _context14.next) {
              case 0:
                _context14.next = 2;
                return this.accountClient.getApplication(this.appID);

              case 2:
                appInfo = _context14.sent;
                return _context14.abrupt("return", appInfo.euis);

              case 4:
              case "end":
                return _context14.stop();
            }
          }
        }, _callee14, this);
      }));

      function getEUIs() {
        return _ref14.apply(this, arguments);
      }

      return getEUIs;
    }()

    /**
     * Return a device address for the given constraints.
     *
     * @param usage - The list for wich the address will be used.
     * @returns address - A buffer containing the address.
     */

  }, {
    key: "getDeviceAddress",
    value: function () {
      var _ref15 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee15() {
        var usage = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : ["abp"];
        var client, req, res;
        return _regenerator2.default.wrap(function _callee15$(_context15) {
          while (1) {
            switch (_context15.prev = _context15.next) {
              case 0:
                client = new _device_address_grpc_pb2.default.DevAddrManagerClient(this.netAddress, this.credentials);
                req = new _device_address_pb2.default.DevAddrRequest();

                req.setUsageList(usage);

                _context15.next = 5;
                return this.exec(client.getDevAddr, req);

              case 5:
                res = _context15.sent;
                return _context15.abrupt("return", new Buffer(res.devAddr, "base64"));

              case 7:
              case "end":
                return _context15.stop();
            }
          }
        }, _callee15, this);
      }));

      function getDeviceAddress() {
        return _ref15.apply(this, arguments);
      }

      return getDeviceAddress;
    }()
  }]);
  return ApplicationClient;
}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hcHBsaWNhdGlvbnMvYXBwbGljYXRpb25zLmpzIl0sIm5hbWVzIjpbInByb2Nlc3MiLCJlbnYiLCJHUlBDX1NTTF9DSVBIRVJfU1VJVEVTIiwiQXBwbGljYXRpb25DbGllbnQiLCJhcHBJRCIsInRva2VuT3JLZXkiLCJuZXRBZGRyZXNzIiwiY2VydGlmaWNhdGUiLCJjcmVkZW50aWFscyIsImNyZWF0ZVNzbCIsIkJ1ZmZlciIsImNyZWF0ZUluc2VjdXJlIiwiY2xpZW50IiwiQXBwbGljYXRpb25NYW5hZ2VyQ2xpZW50IiwiYXBwQWNjZXNzVG9rZW4iLCJhcHBBY2Nlc3NLZXkiLCJhY2NvdW50Q2xpZW50IiwiZm4iLCJhcmdzIiwibWV0YSIsIk1ldGFkYXRhIiwiYWRkIiwicmVzIiwidG9PYmplY3QiLCJyZXEiLCJBcHBsaWNhdGlvbklkZW50aWZpZXIiLCJzZXRBcHBJZCIsImV4ZWMiLCJnZXRBcHBsaWNhdGlvbiIsImFwcCIsInBheWxvYWRGb3JtYXQiLCJmb3JtYXQiLCJzZXQiLCJmbnMiLCJ0byIsInJlZ2lzdGVyT25Kb2luQWNjZXNzS2V5IiwiZGVsZXRlQXBwbGljYXRpb24iLCJ1cGRhdGVzIiwiQXBwbGljYXRpb24iLCJzZXRQYXlsb2FkRm9ybWF0Iiwic2V0UmVnaXN0ZXJPbkpvaW5BY2Nlc3NLZXkiLCJzZXREZWNvZGVyIiwiZGVjb2RlciIsInNldENvbnZlcnRlciIsImNvbnZlcnRlciIsInNldFZhbGlkYXRvciIsInZhbGlkYXRvciIsInNldEVuY29kZXIiLCJlbmNvZGVyIiwic2V0QXBwbGljYXRpb24iLCJnZXREZXZpY2VzRm9yQXBwbGljYXRpb24iLCJkZXZpY2VzTGlzdCIsIm1hcCIsImRldklEIiwiZGV2aWNlIiwic2V0RGV2aWNlIiwiRGV2aWNlSWRlbnRpZmllciIsInNldERldklkIiwiZ2V0RGV2aWNlIiwiZGV2aWNlUmVxdWVzdCIsImRlbGV0ZURldmljZSIsIkRldmljZSIsInNldERlc2NyaXB0aW9uIiwiZGVzY3JpcHRpb24iLCJzZXRMYXRpdHVkZSIsImxhdGl0dWRlIiwic2V0TG9uZ2l0dWRlIiwibG9uZ2l0dWRlIiwic2V0QWx0aXR1ZGUiLCJhbHRpdHVkZSIsImF0dHJpYnV0ZXMiLCJmb3JFYWNoIiwia2V5IiwiZ2V0QXR0cmlidXRlc01hcCIsInNldExvcmF3YW5EZXZpY2UiLCJsb3Jhd2FuRGV2aWNlUmVxdWVzdCIsInNldEFwcEV1aSIsIlVpbnQ4QXJyYXkiLCJhcHBFdWkiLCJzZXREZXZFdWkiLCJkZXZFdWkiLCJzZXREZXZBZGRyIiwiZGV2QWRkciIsInNldE53a1NLZXkiLCJud2tTS2V5Iiwic2V0QXBwU0tleSIsImFwcFNLZXkiLCJzZXRBcHBLZXkiLCJhcHBLZXkiLCJzZXRGQ250VXAiLCJmQ250VXAiLCJzZXRGQ250RG93biIsImZDbnREb3duIiwic2V0RGlzYWJsZUZDbnRDaGVjayIsImRpc2FibGVGQ250Q2hlY2siLCJzZXRVc2VzMzJCaXRGQ250IiwidXNlczMyQml0RkNudCIsImFwcEluZm8iLCJldWlzIiwidXNhZ2UiLCJEZXZBZGRyTWFuYWdlckNsaWVudCIsIkRldkFkZHJSZXF1ZXN0Iiwic2V0VXNhZ2VMaXN0IiwiZ2V0RGV2QWRkciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUtBOzs7O0FBRUE7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUVBOztBQUNBOzs7O0FBQ0E7O0FBRUE7Ozs7OzttQ0FqQkE7QUFDQTs7QUFzQkE7QUFDQUEsUUFBUUMsR0FBUixDQUFZQyxzQkFBWjs7QUFFQTs7OztJQUdhQyxpQixXQUFBQSxpQjs7QUF1Qlg7Ozs7Ozs7Ozs7O0FBTkE7OztBQU5BOzs7QUFOQTtBQTJCQSw2QkFBYUMsS0FBYixFQUE2QkMsVUFBN0IsRUFBa0RDLFVBQWxELEVBQXVFQyxXQUF2RSxFQUFnSDtBQUFBOztBQUM5RyxRQUFNQyxjQUNKRCxjQUNJLGVBQUtDLFdBQUwsQ0FBaUJDLFNBQWpCLENBQTJCRixl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Qjs7Ozs7Ozs7Ozs7WUFNd0JDLEssdUVBQXVCLENBQUUsS0FBRixDOzs7Ozs7QUFDdkN2RixzQixHQUFTLElBQUksaUNBQUt3RixvQkFBVCxDQUE4QixLQUFLOUYsVUFBbkMsRUFBK0MsS0FBS0UsV0FBcEQsQztBQUNUZ0IsbUIsR0FBTSxJQUFJLDRCQUFRNkUsY0FBWixFOztBQUNaN0Usb0JBQUk4RSxZQUFKLENBQWlCSCxLQUFqQjs7O3VCQUVrQixLQUFLeEUsSUFBTCxDQUFVZixPQUFPMkYsVUFBakIsRUFBNkIvRSxHQUE3QixDOzs7QUFBWkYsbUI7bURBRUMsSUFBSVosTUFBSixDQUFXWSxJQUFJNEQsT0FBZixFQUF3QixRQUF4QixDIiwiZmlsZSI6ImFwcGxpY2F0aW9ucy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCDCqSAyMDE3IFRoZSBUaGluZ3MgTmV0d29ya1xuLy8gVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgdGhlIE1JVCBsaWNlbnNlIHRoYXQgY2FuIGJlIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUuXG5cbi8vIEBmbG93XG5cbmltcG9ydCBncnBjIGZyb20gXCJncnBjXCJcblxuaW1wb3J0IHByb3RvIGZyb20gXCJ0dG5hcGkvaGFuZGxlci9oYW5kbGVyX3BiXCJcbmltcG9ydCBsb3Jhd2FuIGZyb20gXCJ0dG5hcGkvcHJvdG9jb2wvbG9yYXdhbi9kZXZpY2VfcGJcIlxuaW1wb3J0IGhhbmRsZXIgZnJvbSBcInR0bmFwaS9oYW5kbGVyL2hhbmRsZXJfZ3JwY19wYlwiXG5pbXBvcnQgYWRkciBmcm9tIFwidHRuYXBpL3Byb3RvY29sL2xvcmF3YW4vZGV2aWNlX2FkZHJlc3NfZ3JwY19wYlwiXG5pbXBvcnQgZGV2YWRkciBmcm9tIFwidHRuYXBpL3Byb3RvY29sL2xvcmF3YW4vZGV2aWNlX2FkZHJlc3NfcGJcIlxuXG5pbXBvcnQgeyB3cmFwLCBNT0RFUk5fQ0lQSEVSX1NVSVRFUyB9IGZyb20gXCIuLi91dGlsc1wiXG5pbXBvcnQgaXNUb2tlbiBmcm9tIFwiLi4vdXRpbHMvaXMtdG9rZW5cIlxuaW1wb3J0IHsgQWNjb3VudENsaWVudCB9IGZyb20gXCIuLi9hY2NvdW50XCJcblxuaW1wb3J0IG5vcm1hbGl6ZSBmcm9tIFwiLi9ub3JtYWxpemVcIlxuXG5pbXBvcnQgdHlwZSB7IERldmljZSwgQXBwbGljYXRpb24sIEFwcGxpY2F0aW9uVXBkYXRlcywgUGF5bG9hZEZ1bmN0aW9ucywgRGV2aWNlVXBkYXRlcywgTG9yYXdhbkRldmljZVVwZGF0ZXMsIFBheWxvYWRGb3JtYXQgfSBmcm9tIFwiLi90eXBlc1wiXG5cbnR5cGUgVXNhZ2UgPSBcIm90YWFcIiB8IFwiYWJwXCIgfCBcIndvcmxkXCIgfCBcImxvY2FsXCIgfCBcInByaXZhdGVcIiB8IFwidGVzdGluZ1wiXG5cbi8vIE5lY2Vzc2FyeSB0byBtYWtlIGdSUEMgd29ya1xucHJvY2Vzcy5lbnYuR1JQQ19TU0xfQ0lQSEVSX1NVSVRFUyA9IE1PREVSTl9DSVBIRVJfU1VJVEVTXG5cbi8qKlxuICogQSBjbGllbnQgdGhhdCBtYW5hZ2VzIGRldmljZXMgb24gdGhlIGhhbmRsZXIuXG4gKi9cbmV4cG9ydCBjbGFzcyBBcHBsaWNhdGlvbkNsaWVudCB7XG5cbiAgLyoqIEBwcml2YXRlICovXG4gIGFwcElEIDogc3RyaW5nXG5cbiAgLyoqIEBwcml2YXRlICovXG4gIGFwcEFjY2Vzc0tleSA6ID9zdHJpbmdcblxuICAvKiogQHByaXZhdGUgKi9cbiAgYXBwQWNjZXNzVG9rZW4gOiA/c3RyaW5nXG5cbiAgLyoqIEBwcml2YXRlICovXG4gIGNsaWVudCA6IGFueVxuXG4gIC8qKiBAcHJpdmF0ZSAqL1xuICBhY2NvdW50Q2xpZW50IDogQWNjb3VudENsaWVudFxuXG4gIC8qKiBAcHJpdmF0ZSAqL1xuICBjcmVkZW50aWFscyA6IGFueVxuXG4gIC8qKiBAcHJpdmF0ZSAqL1xuICBuZXRBZGRyZXNzIDogc3RyaW5nXG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhbmQgb3BlbiBhbiBhcHBsaWNhdGlvbiBtYW5hZ2VyIGNsaWVudCB0aGF0IGNhbiBiZSB1c2VkIGZvclxuICAgKiByZXRyZWl2aW5nIGFuZCB1cGRhdGluZyBhbiBhcHBsaWNhdGlvbiBhbmQgaXRzIGRldmljZXMuXG4gICAqXG4gICAqIEBwYXJhbSBhcHBJRCAtIFRoZSBJRCBvZiB0aGUgYXBwbGljYXRpb24geW91IHdhbnQgdG8gbWFuYWdlXG4gICAqIEBwYXJhbSB0b2tlbk9yS2V5IC0gVGhlIEFjY2VzcyBUb2tlbiBvciBBY2Nlc3MgS2V5IHVzZWQgdG8gYXV0aGVudGljYXRlXG4gICAqIEBwYXJhbSBuZXRBZGRyZXNzIC0gVGhlIGdSUEMgYWRkcmVzcyBvZiB0aGUgaGFuZGxlciB3aGVyZSB0aGUgYXBwbGljYXRpb24gaXMgcmVnaXN0ZXJlZFxuICAgKiBAcGFyYW0gY2VydGlmaWNhdGUgLSBBbiBvcHRpb25hbCBjZXJ0aWZpY2F0ZSB1c2VkIHRvIGNvbm5lY3QgdG8gdGhlIGhhbmRsZXIgc2VjdXJlbHlcbiAgICovXG4gIGNvbnN0cnVjdG9yIChhcHBJRCA6IHN0cmluZywgdG9rZW5PcktleSA6IHN0cmluZywgbmV0QWRkcmVzcyA6IHN0cmluZywgY2VydGlmaWNhdGUgOiA/KEJ1ZmZlciB8IHN0cmluZykpIDogdm9pZCB7XG4gICAgY29uc3QgY3JlZGVudGlhbHMgPVxuICAgICAgY2VydGlmaWNhdGVcbiAgICAgICAgPyBncnBjLmNyZWRlbnRpYWxzLmNyZWF0ZVNzbChjZXJ0aWZpY2F0ZSAmJiBuZXcgQnVmZmVyKGNlcnRpZmljYXRlKSlcbiAgICAgICAgOiBncnBjLmNyZWRlbnRpYWxzLmNyZWF0ZUluc2VjdXJlKClcblxuICAgIHRoaXMuY2xpZW50ID0gbmV3IGhhbmRsZXIuQXBwbGljYXRpb25NYW5hZ2VyQ2xpZW50KG5ldEFkZHJlc3MsIGNyZWRlbnRpYWxzKVxuICAgIHRoaXMuY3JlZGVudGlhbHMgPSBjcmVkZW50aWFsc1xuICAgIHRoaXMubmV0QWRkcmVzcyA9IG5ldEFkZHJlc3NcbiAgICB0aGlzLmFwcElEID0gYXBwSURcblxuICAgIGlmIChpc1Rva2VuKHRva2VuT3JLZXkpKSB7XG4gICAgICB0aGlzLmFwcEFjY2Vzc1Rva2VuID0gdG9rZW5PcktleVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmFwcEFjY2Vzc0tleSA9IHRva2VuT3JLZXlcbiAgICB9XG5cbiAgICB0aGlzLmFjY291bnRDbGllbnQgPSBuZXcgQWNjb3VudENsaWVudCh0b2tlbk9yS2V5KVxuICB9XG5cbiAgLyoqIEBwcml2YXRlICovXG4gIGFzeW5jIGV4ZWMgKGZuIDogRnVuY3Rpb24sIC4uLmFyZ3MgOiBhbnlbXSkgOiBQcm9taXNlPCo+IHtcbiAgICBjb25zdCBtZXRhID0gbmV3IGdycGMuTWV0YWRhdGEoKVxuICAgIGlmICh0aGlzLmFwcEFjY2Vzc1Rva2VuKSB7XG4gICAgICBtZXRhLmFkZChcInRva2VuXCIsIHRoaXMuYXBwQWNjZXNzVG9rZW4pXG4gICAgfSBlbHNlIGlmICh0aGlzLmFwcEFjY2Vzc0tleSkge1xuICAgICAgbWV0YS5hZGQoXCJrZXlcIiwgdGhpcy5hcHBBY2Nlc3NLZXkpXG4gICAgfVxuXG4gICAgY29uc3QgcmVzID0gYXdhaXQgd3JhcCh0aGlzLmNsaWVudCwgZm4sIC4uLmFyZ3MsIG1ldGEpXG5cbiAgICByZXR1cm4gcmVzLnRvT2JqZWN0KClcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGFwcGxpY2F0aW9uXG4gICAqL1xuICBhc3luYyBnZXQgKCkgOiBQcm9taXNlPEFwcGxpY2F0aW9uPiB7XG4gICAgY29uc3QgcmVxID0gbmV3IHByb3RvLkFwcGxpY2F0aW9uSWRlbnRpZmllcigpXG4gICAgcmVxLnNldEFwcElkKHRoaXMuYXBwSUQpXG5cbiAgICBjb25zdCBhcHAgPSBhd2FpdCB0aGlzLmV4ZWModGhpcy5jbGllbnQuZ2V0QXBwbGljYXRpb24sIHJlcSlcbiAgICBhcHAucGF5bG9hZEZvcm1hdCA9IGFwcC5wYXlsb2FkRm9ybWF0IHx8IFwiY3VzdG9tXCJcblxuICAgIHJldHVybiBhcHBcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGFuZ2UgdGhlIHBheWxvYWQgZm9ybWF0IG9mIHRoZSBhcHBsaWNhdGlvbi5cbiAgICovXG4gIGFzeW5jIHNldFBheWxvYWRGb3JtYXQgKGZvcm1hdCA6IFBheWxvYWRGb3JtYXQpIDogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgdGhpcy5zZXQoe1xuICAgICAgcGF5bG9hZEZvcm1hdDogZm9ybWF0LFxuICAgIH0pXG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBjdXN0b20gcGF5bG9hZCBmdW5jdGlvbnMgb2YgdGhlIGFwcGxpY2F0aW9uIGFuZCBzZXQgdGhlIGZvcm1hdFxuICAgKiB0byBjdXN0b20uXG4gICAqL1xuICBhc3luYyBzZXRDdXN0b21QYXlsb2FkRnVuY3Rpb25zIChmbnMgOiBQYXlsb2FkRnVuY3Rpb25zID0ge30pIDogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgdGhpcy5zZXQoe1xuICAgICAgcGF5bG9hZEZvcm1hdDogXCJjdXN0b21cIixcbiAgICAgIC4uLmZucyxcbiAgICB9KVxuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgcmVnaXN0ZXJPbkpvaW5BY2Nlc3NLZXkgb3IgcmVtb3ZlIGl0LlxuICAgKi9cbiAgYXN5bmMgc2V0UmVnaXN0ZXJPbkpvaW5BY2Nlc3NLZXkgKHRvIDogc3RyaW5nKSA6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMuc2V0KHtcbiAgICAgIHJlZ2lzdGVyT25Kb2luQWNjZXNzS2V5OiB0byxcbiAgICB9KVxuICB9XG5cbiAgLyoqXG4gICAqIFVucmVnaXN0ZXIgdGhlIGFwcGxpY2F0aW9uIGZyb20gdGhlIGhhbmRsZXIuXG4gICAqL1xuICBhc3luYyB1bnJlZ2lzdGVyICgpIDogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgcmVxID0gbmV3IHByb3RvLkFwcGxpY2F0aW9uSWRlbnRpZmllcigpXG4gICAgcmVxLnNldEFwcElkKHRoaXMuYXBwSUQpXG4gICAgcmV0dXJuIHRoaXMuZXhlYyh0aGlzLmNsaWVudC5kZWxldGVBcHBsaWNhdGlvbiwgcmVxKVxuICB9XG5cbiAgLyoqIEBwcml2YXRlICovXG4gIGFzeW5jIHNldCAodXBkYXRlcyA6IEFwcGxpY2F0aW9uVXBkYXRlcyA9IHt9KSA6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHJlcSA9IG5ldyBwcm90by5BcHBsaWNhdGlvbigpXG5cbiAgICByZXEuc2V0QXBwSWQodGhpcy5hcHBJRClcblxuICAgIGlmIChcInBheWxvYWRGb3JtYXRcIiBpbiB1cGRhdGVzKSB7XG4gICAgICByZXEuc2V0UGF5bG9hZEZvcm1hdCh1cGRhdGVzLnBheWxvYWRGb3JtYXQpXG4gICAgfVxuXG4gICAgaWYgKFwicmVnaXN0ZXJPbkpvaW5BY2Nlc3NLZXlcIiBpbiB1cGRhdGVzKSB7XG4gICAgICByZXEuc2V0UmVnaXN0ZXJPbkpvaW5BY2Nlc3NLZXkodXBkYXRlcy5yZWdpc3Rlck9uSm9pbkFjY2Vzc0tleSlcbiAgICB9XG5cbiAgICBpZiAoXCJkZWNvZGVyXCIgaW4gdXBkYXRlcykge1xuICAgICAgcmVxLnNldERlY29kZXIodXBkYXRlcy5kZWNvZGVyKVxuICAgIH1cblxuICAgIGlmIChcImNvbnZlcnRlclwiIGluIHVwZGF0ZXMpIHtcbiAgICAgIHJlcS5zZXRDb252ZXJ0ZXIodXBkYXRlcy5jb252ZXJ0ZXIpXG4gICAgfVxuXG4gICAgaWYgKFwidmFsaWRhdG9yXCIgaW4gdXBkYXRlcykge1xuICAgICAgcmVxLnNldFZhbGlkYXRvcih1cGRhdGVzLnZhbGlkYXRvcilcbiAgICB9XG5cbiAgICBpZiAoXCJlbmNvZGVyXCIgaW4gdXBkYXRlcykge1xuICAgICAgcmVxLnNldEVuY29kZXIodXBkYXRlcy5lbmNvZGVyKVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmV4ZWModGhpcy5jbGllbnQuc2V0QXBwbGljYXRpb24sIHJlcSlcbiAgfVxuXG4gIC8qKlxuICAgKiBMaXN0IHRoZSBkZXZpY2VzIG9mIHRoZSBhcHBsaWNhdGlvblxuICAgKi9cbiAgYXN5bmMgZGV2aWNlcyAoKSA6IFByb21pc2U8RGV2aWNlW10+IHtcbiAgICBjb25zdCByZXEgPSBuZXcgcHJvdG8uQXBwbGljYXRpb25JZGVudGlmaWVyKClcbiAgICByZXEuc2V0QXBwSWQodGhpcy5hcHBJRClcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmV4ZWModGhpcy5jbGllbnQuZ2V0RGV2aWNlc0ZvckFwcGxpY2F0aW9uLCByZXEpXG4gICAgcmV0dXJuIHJlcy5kZXZpY2VzTGlzdC5tYXAobm9ybWFsaXplKVxuICB9XG5cbiAgLyoqXG4gICAqIFJlZ2lzdGVyIGEgZGV2aWNlIGluIHRoZSBhcHBsaWNhdGlvbi5cbiAgICovXG4gIGFzeW5jIHJlZ2lzdGVyRGV2aWNlIChkZXZJRCA6IHN0cmluZywgZGV2aWNlIDogRGV2aWNlVXBkYXRlcykgOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gdGhpcy5zZXREZXZpY2UoZGV2SUQsIGRldmljZSlcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGRldmljZSBzcGVjaWZpZWQgYnkgdGhlIGRldklEXG4gICAqL1xuICBhc3luYyBkZXZpY2UgKGRldklEIDogc3RyaW5nKSA6IFByb21pc2U8RGV2aWNlPiB7XG4gICAgY29uc3QgcmVxID0gbmV3IHByb3RvLkRldmljZUlkZW50aWZpZXIoKVxuICAgIHJlcS5zZXRBcHBJZCh0aGlzLmFwcElEKVxuICAgIHJlcS5zZXREZXZJZChkZXZJRClcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmV4ZWModGhpcy5jbGllbnQuZ2V0RGV2aWNlLCByZXEpXG4gICAgcmV0dXJuIG5vcm1hbGl6ZShyZXMpXG4gIH1cblxuICAvKiogQHByaXZhdGUgKi9cbiAgYXN5bmMgc2V0RGV2aWNlIChkZXZJRCA6IHN0cmluZywgZGV2aWNlIDogRGV2aWNlVXBkYXRlcykgOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCByZXEgPSB0aGlzLmRldmljZVJlcXVlc3QoZGV2SUQsIGRldmljZSlcbiAgICByZXR1cm4gdGhpcy5leGVjKHRoaXMuY2xpZW50LnNldERldmljZSwgcmVxKVxuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSB0aGUgZGV2aWNlIHNwZWNpZmllZCBieSB0aGUgZGV2SUQgd2l0aCB0aGUgc3BlY2lmaWVkIHVwZGF0ZXNcbiAgICovXG4gIGFzeW5jIHVwZGF0ZURldmljZSAoZGV2SUQgOiBzdHJpbmcsIHVwZGF0ZXMgOiBEZXZpY2VVcGRhdGVzKSA6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGRldmljZSA9IGF3YWl0IHRoaXMuZGV2aWNlKGRldklEKVxuICAgIGNvbnN0IHJlcSA9IHRoaXMuZGV2aWNlUmVxdWVzdChkZXZJRCwgeyAuLi5kZXZpY2UsIC4uLnVwZGF0ZXMgfSlcbiAgICByZXR1cm4gdGhpcy5leGVjKHRoaXMuY2xpZW50LnNldERldmljZSwgcmVxKVxuICB9XG5cbiAgLyoqXG4gICAqIERlbGV0ZSB0aGUgc3BlY2lmaWVkIGRldmljZS5cbiAgICovXG4gIGFzeW5jIGRlbGV0ZURldmljZSAoZGV2SUQgOiBzdHJpbmcpIDogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgcmVxID0gbmV3IHByb3RvLkRldmljZUlkZW50aWZpZXIoKVxuICAgIHJlcS5zZXRBcHBJZCh0aGlzLmFwcElEKVxuICAgIHJlcS5zZXREZXZJZChkZXZJRClcbiAgICByZXR1cm4gdGhpcy5leGVjKHRoaXMuY2xpZW50LmRlbGV0ZURldmljZSwgcmVxKVxuICB9XG5cbiAgLyoqIEBwcml2YXRlICovXG4gIGRldmljZVJlcXVlc3QgKGRldklEIDogc3RyaW5nLCBkZXZpY2UgOiBEZXZpY2VVcGRhdGVzID0ge30pIDogYW55IHtcbiAgICBjb25zdCByZXEgPSBuZXcgcHJvdG8uRGV2aWNlKClcbiAgICByZXEuc2V0QXBwSWQodGhpcy5hcHBJRClcbiAgICByZXEuc2V0RGV2SWQoZGV2SUQpXG5cbiAgICBpZiAoXCJkZXNjcmlwdGlvblwiIGluIGRldmljZSkge1xuICAgICAgcmVxLnNldERlc2NyaXB0aW9uKGRldmljZS5kZXNjcmlwdGlvbilcbiAgICB9XG5cbiAgICBpZiAoXCJsYXRpdHVkZVwiIGluIGRldmljZSkge1xuICAgICAgcmVxLnNldExhdGl0dWRlKGRldmljZS5sYXRpdHVkZSlcbiAgICB9XG5cbiAgICBpZiAoXCJsb25naXR1ZGVcIiBpbiBkZXZpY2UpIHtcbiAgICAgIHJlcS5zZXRMb25naXR1ZGUoZGV2aWNlLmxvbmdpdHVkZSlcbiAgICB9XG5cbiAgICBpZiAoXCJhbHRpdHVkZVwiIGluIGRldmljZSkge1xuICAgICAgcmVxLnNldEFsdGl0dWRlKGRldmljZS5hbHRpdHVkZSlcbiAgICB9XG5cbiAgICBpZiAoXCJhdHRyaWJ1dGVzXCIgaW4gZGV2aWNlKSB7XG4gICAgICBPYmplY3Qua2V5cyhkZXZpY2UuYXR0cmlidXRlcykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIHJlcS5nZXRBdHRyaWJ1dGVzTWFwKCkuc2V0KGtleSwgZGV2aWNlLmF0dHJpYnV0ZXNba2V5XSlcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgcmVxLnNldExvcmF3YW5EZXZpY2UodGhpcy5sb3Jhd2FuRGV2aWNlUmVxdWVzdChkZXZJRCwgZGV2aWNlKSlcblxuICAgIHJldHVybiByZXFcbiAgfVxuXG4gIC8qKiBAcHJpdmF0ZSAqL1xuICBsb3Jhd2FuRGV2aWNlUmVxdWVzdCAoZGV2SUQgOiBzdHJpbmcsIGRldmljZSA6IExvcmF3YW5EZXZpY2VVcGRhdGVzID0ge30pIDogYW55IHtcbiAgICBjb25zdCByZXEgPSBuZXcgbG9yYXdhbi5EZXZpY2UoKVxuXG4gICAgcmVxLnNldEFwcElkKHRoaXMuYXBwSUQpXG4gICAgcmVxLnNldERldklkKGRldklEKVxuXG4gICAgaWYgKFwiYXBwRXVpXCIgaW4gZGV2aWNlKSB7XG4gICAgICByZXEuc2V0QXBwRXVpKG5ldyBVaW50OEFycmF5KG5ldyBCdWZmZXIoZGV2aWNlLmFwcEV1aSwgXCJoZXhcIikpKVxuICAgIH1cblxuICAgIGlmIChcImRldkV1aVwiIGluIGRldmljZSkge1xuICAgICAgcmVxLnNldERldkV1aShuZXcgVWludDhBcnJheShuZXcgQnVmZmVyKGRldmljZS5kZXZFdWksIFwiaGV4XCIpKSlcbiAgICB9XG5cbiAgICBpZiAoXCJkZXZBZGRyXCIgaW4gZGV2aWNlKSB7XG4gICAgICByZXEuc2V0RGV2QWRkcihuZXcgVWludDhBcnJheShuZXcgQnVmZmVyKGRldmljZS5kZXZBZGRyLCBcImhleFwiKSkpXG4gICAgfVxuXG4gICAgaWYgKFwibndrU0tleVwiIGluIGRldmljZSkge1xuICAgICAgcmVxLnNldE53a1NLZXkobmV3IFVpbnQ4QXJyYXkobmV3IEJ1ZmZlcihkZXZpY2UubndrU0tleSwgXCJoZXhcIikpKVxuICAgIH1cblxuICAgIGlmIChcImFwcFNLZXlcIiBpbiBkZXZpY2UpIHtcbiAgICAgIHJlcS5zZXRBcHBTS2V5KG5ldyBVaW50OEFycmF5KG5ldyBCdWZmZXIoZGV2aWNlLmFwcFNLZXksIFwiaGV4XCIpKSlcbiAgICB9XG5cbiAgICBpZiAoXCJhcHBLZXlcIiBpbiBkZXZpY2UpIHtcbiAgICAgIHJlcS5zZXRBcHBLZXkobmV3IFVpbnQ4QXJyYXkobmV3IEJ1ZmZlcihkZXZpY2UuYXBwS2V5LCBcImhleFwiKSkpXG4gICAgfVxuXG4gICAgaWYgKFwiZkNudFVwXCIgaW4gZGV2aWNlKSB7XG4gICAgICByZXEuc2V0RkNudFVwKGRldmljZS5mQ250VXApXG4gICAgfVxuXG4gICAgaWYgKFwiZkNudERvd25cIiBpbiBkZXZpY2UpIHtcbiAgICAgIHJlcS5zZXRGQ250RG93bihkZXZpY2UuZkNudERvd24pXG4gICAgfVxuXG4gICAgaWYgKFwiZGlzYWJsZUZDbnRDaGVja1wiIGluIGRldmljZSkge1xuICAgICAgcmVxLnNldERpc2FibGVGQ250Q2hlY2soZGV2aWNlLmRpc2FibGVGQ250Q2hlY2spXG4gICAgfVxuXG4gICAgaWYgKFwidXNlczMyQml0RkNudFwiIGluIGRldmljZSkge1xuICAgICAgcmVxLnNldFVzZXMzMkJpdEZDbnQoZGV2aWNlLnVzZXMzMkJpdEZDbnQpXG4gICAgfVxuXG4gICAgcmV0dXJuIHJlcVxuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIEVVSShzKSBmb3IgdGhpcyBhcHBsaWNhdGlvbiBmcm9tIHRoZSBhY2NvdW50IHNlcnZlci5cbiAgICovXG4gIGFzeW5jIGdldEVVSXMgKCkgOiBQcm9taXNlPEFycmF5PHN0cmluZz4+IHtcbiAgICBjb25zdCBhcHBJbmZvID0gYXdhaXQgdGhpcy5hY2NvdW50Q2xpZW50LmdldEFwcGxpY2F0aW9uKHRoaXMuYXBwSUQpXG5cbiAgICByZXR1cm4gYXBwSW5mby5ldWlzXG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIGEgZGV2aWNlIGFkZHJlc3MgZm9yIHRoZSBnaXZlbiBjb25zdHJhaW50cy5cbiAgICpcbiAgICogQHBhcmFtIHVzYWdlIC0gVGhlIGxpc3QgZm9yIHdpY2ggdGhlIGFkZHJlc3Mgd2lsbCBiZSB1c2VkLlxuICAgKiBAcmV0dXJucyBhZGRyZXNzIC0gQSBidWZmZXIgY29udGFpbmluZyB0aGUgYWRkcmVzcy5cbiAgICovXG4gIGFzeW5jIGdldERldmljZUFkZHJlc3MgKHVzYWdlIDogQXJyYXk8VXNhZ2U+ID0gWyBcImFicFwiIF0pIDogUHJvbWlzZTxCdWZmZXI+IHtcbiAgICBjb25zdCBjbGllbnQgPSBuZXcgYWRkci5EZXZBZGRyTWFuYWdlckNsaWVudCh0aGlzLm5ldEFkZHJlc3MsIHRoaXMuY3JlZGVudGlhbHMpXG4gICAgY29uc3QgcmVxID0gbmV3IGRldmFkZHIuRGV2QWRkclJlcXVlc3QoKVxuICAgIHJlcS5zZXRVc2FnZUxpc3QodXNhZ2UpXG5cbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmV4ZWMoY2xpZW50LmdldERldkFkZHIsIHJlcSlcblxuICAgIHJldHVybiBuZXcgQnVmZmVyKHJlcy5kZXZBZGRyLCBcImJhc2U2NFwiKVxuICB9XG59XG5cbiJdfQ==